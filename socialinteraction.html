
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Social Recommendation</title>
        <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
        <link href="./assets/css/font-awesome.min.css" rel="stylesheet">
    </head>
    <body>
    <!-- Fixed navbar -->
    <div id="includeNav"></div>
    <div class="container" role="main">
        <div class="page-header" style="margin-top:60px">
            <h1>Let's Share to Friends</h1><span>Select friend who might interested the product with you.</span>
        </div>
        <div class="row">
            <div class="col-md-12" style="margin-bottom:15px">
                <div class="row">
                    <div class="col-md-6 displayProductResult">
                        
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-4 displayFriendResult">
                                
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 10px;float:right">
                            <div class="col-md-12">
                                <button class="btn btn-primary btnShare"><span class="glyphicon glyphicon-user"></span> แชร์ผ่าน Social</button>
                                <button class="btn btn-primary btnAsk"><span class="glyphicon glyphicon-user"></span> ถามเพื่อน</button>
                                <button class="btn btn-primary btnSuggest"><span class="glyphicon glyphicon-user"></span> แนะนำของให้เพื่อน</button>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 5px;float:right">
                            <div class="col-md-12">
                                <button class="btn btn-primary btnRequest"><span class="glyphicon glyphicon-user"></span> ซื้อให้หน่อย</button>
                                <button class="btn btn-primary btnFriendCart"><span class="glyphicon glyphicon-user"></span> เพิ่มลงในตะกร้าเพื่อน</button>
                                <button class="btn btn-primary btnBuyForFriend"><span class="glyphicon glyphicon-user"></span> ซื้อให้เพื่อน</button>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- /container -->

    <script src="./assets/js/jquery.min.js"></script>
    <script src="./assets/js/bootstrap.min.js"></script>
    <script>
        $(function(){
            $("#includeNav").load("navbar.html"); 
        });
    </script>
    <script>
        
        $(document).ready( function(){
            var obj = '';
            // console.log(localStorage.getItem('response')); // read
            var accessToken = 'Bearer ' + localStorage.getItem('response');
            console.log('this is Access token response: ' + accessToken);
            //get product by id
            var productId = url ? url.split('=')[1] : window.location.search.slice(11);
            // console.log('This is url param ', productId);
            var productUrl = 'http://128.199.251.234:3001/product/'+productId+'?activityTypeId=1';
            //get friend
            var url = "";
            var friendUrl = "http://128.199.251.234:3001/user/friends";
            //post share url
            var shareUrl = "http://128.199.251.234:3001/";
            //post ask url
            var askUrl = 'http://128.199.251.234:3001/product/'+productId+'/ask';
            //post suggest url
            var suggestUrl = 'http://128.199.251.234:3001/product/'+productId+'/suggest';
            //post request
            var requestUrl = 'http://128.199.251.234:3001/product/'+productId+'/request';
            //post add friend cart
            var friendCartUrl = "http://128.199.251.234:3001/cart/friend";
            //post buy to friend
            var buyForUrl = "http://128.199.251.234:3001/product/buy";
            var head = {
                Authorization:  accessToken
            };
            $.ajax({
                type: "GET",
                url: productUrl,
                headers: head,
                success: function(res){
                    var responses = handleData(res);
                },
                error: function(err){
                    alert('Error ', err.status);
                    return err;
                }
            });
            //ajax get user Friends
            $.ajax({
                type: "GET",
                url: friendUrl,
                headers: head,
                success: function(res){
                    var responses = handleFriendData(res);
                },
                error: function(err){
                    alert('Error ', err.status);
                    return err;
                }
            });
            function handleData(res) {
                if(!res.error){
                    var rowValue ='<img src='+res.product.imageUrl+' class="img-responsive img-thumbnail" style="width:100%">';
                    $('.displayProductResult').append(rowValue);
                }else{
                    alert(res.error);
                }
            };
            function handleFriendData(res) {
                if(!res.error){
                    console.log(res);
                    var rowValue ='<label class="btn btn-primary"><img src="./assets/img/200x200.svg" class="img-responsive img-thumbnail img-check" style="width:100%"><input type="checkbox" name="chk1" id="item4" value="val1" class="hidden" autocomplete="off"></label>';
                    $('.displayFriendResult').append(rowValue);
                }else{
                    alert(res.error);
                }
            };
            $('.btnBuyForFriend').on("click",function(){
                var head = {
                    Authorization:  accessToken
                };
                obj = {
                    activityTypeId: 9,
                    productId: parseInt(productId),
                    friendId: 1
                };
                console.log('this is val data', obj);
                $.ajax({
                    type: "POST",
                    url: url,
                    headers: head,
                    data: JSON.stringify(obj),
                    contentType: "application/json",
                    success: function(res){
                        alert('Your friend will be happy. Thank you. ', res);
                    },
                    error: function(err){
                        alert('Oops, Sorry can you try again? ', err);
                        window.location.reload();
                    }
                });
            });
        });

        // $(document).ready(function(e){
    	// 	$(".img-check").click(function(){
		// 		$(this).toggleClass("check");
        //         var friend = [{age : 0, name:""}];
        //         // friend.push($(this).val());
        //         friend.push({age: 35, name: "John Doe"});
        //         console.log('Friend: ' + friend[0].name);
		// 	});
        // });
    </script>
  </body>
</html>
